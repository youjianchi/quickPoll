# QuickPoll (React + Supabase)

QuickPoll is a single-page React application that talks directly to Supabase. You can spin up polls, share them by ID, vote, and watch the results refresh every two seconds — all without maintaining a custom backend.

```
quickpoll/
├─ client/          # React + Vite app (the app you run)
├─ package.json     # Legacy root package (unused now that the backend is gone)
└─ ...
```

## 1. Prepare Supabase

1. Create (or reuse) a Supabase project and grab the **Project URL** and **anon key** from **Project Settings → API**.
2. In the SQL editor, run the script below to create the schema, enable Row Level Security, and expose the RPCs used by the React app.

   ```sql
   -- Core tables
   create table if not exists polls (
     id bigint generated by default as identity primary key,
     question text not null,
     created_at timestamptz not null default timezone('utc', now())
   );

   create table if not exists options (
     id bigint generated by default as identity primary key,
     poll_id bigint not null references polls(id) on delete cascade,
     text text not null,
     votes integer not null default 0
   );

   -- Row Level Security + permissive policies for the anonymous key.
   alter table polls enable row level security;
   alter table options enable row level security;

   create policy "Polls are readable by everyone" on polls
     for select using (true);

   create policy "Polls can be created by anyone" on polls
     for insert with check (true);

   create policy "Polls can be removed by their creator fallback" on polls
     for delete using (true); -- optional, used only if option insertion fails

  create policy "Options are readable by everyone" on options
     for select using (true);

   create policy "Options can be created by anyone" on options
     for insert with check (true);

   -- Voting uses an RPC so we don't need a direct UPDATE policy.
   create or replace function vote_on_option(input_poll_id bigint, input_option_id bigint)
   returns boolean
   language plpgsql
   security definer
   set search_path = public
   as $$
   declare
     updated integer;
   begin
     update options
     set votes = votes + 1
     where id = input_option_id and poll_id = input_poll_id;

     get diagnostics updated = row_count;
     return updated > 0;
   end;
   $$;

   grant execute on function vote_on_option(bigint, bigint) to anon;
   ```

   > **Tip:** For production you will probably want stricter policies (e.g., based on authenticated user IDs). The above is intentionally permissive so the anonymous browser key can manage demo polls.

## 2. Configure environment variables (React)

Set up a `.env` file in `client/` using the example as a starting point:

```bash
cd client
cp .env.example .env
```

Fill in:

| Variable                  | Description                                               |
| ------------------------ | --------------------------------------------------------- |
| `VITE_SUPABASE_URL`      | Supabase project URL (e.g. `https://xyz.supabase.co`).    |
| `VITE_SUPABASE_ANON_KEY` | The public anon key (do **not** use the service role key). |

## 3. Install packages & run the app

```bash
cd client
npm install
npm run dev
```

This launches Vite at `http://localhost:5173` (or the next available port). Open it in your browser to create and vote on polls.

### Production build

```bash
cd client
npm run build      # output goes to client/dist
npm run preview    # optional local preview of the production bundle
```

## Common Troubleshooting

- **Environment errors at runtime**: Vite requires variables to be prefixed with `VITE_`. Double-check your `.env` values.
- **Insert or vote fails**: Make sure you ran the SQL script, especially the RLS policies and `vote_on_option` function + grant.
- **Live refresh stops working**: The app polls Supabase every 2 seconds. Check the browser console for Supabase errors.

Happy building! This repo is now a pure React + Supabase project; feel free to delete the legacy root `package.json`/`node_modules` if you no longer need them.
